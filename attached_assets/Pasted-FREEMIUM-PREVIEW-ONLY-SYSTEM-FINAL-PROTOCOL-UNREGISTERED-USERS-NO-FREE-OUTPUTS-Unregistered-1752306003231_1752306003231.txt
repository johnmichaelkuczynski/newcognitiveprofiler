FREEMIUM PREVIEW-ONLY SYSTEM (FINAL PROTOCOL)
ğŸ‘¤ UNREGISTERED USERS (NO FREE OUTPUTS)
Unregistered users are never given full results, regardless of input length.

âœ… They receive a preview only â€” short, local, fake, or partial content

âœ… Previews incur zero API/token cost

âœ… Every preview ends with an upgrade prompt

Standard Preview Message:

âœ¨ This is a preview of your result.
ğŸ”’ Unlock full results by registering and purchasing credits.
[Register & Unlock Full Access]

Example Previews:

Grading App: â€œGrade: B+ â€” Promising workâ€¦â€ â†’ [Upgrade to see full feedback]

Comparison App: â€œEinstein: A+, You: Bâ€¦â€ â†’ [Upgrade to view detailed comparison]

Rewrite App: â€œOpening sentence revisedâ€¦â€ â†’ [Upgrade to unlock complete rewrite]

ğŸ”‘ REGISTERED USERS + CREDIT SYSTEM
ğŸ” REGISTRATION
Email + password (no email verification)

Auth persists across reloads

Logged-in users are never auto-logged out

ğŸ’³ CREDIT PURCHASE (Stripe Checkout)
Price	Tokens
$1	2,000
$10	30,000
$100	600,000
$1,000	10,000,000

Token balance updates immediately post-payment

Stored in Neon database, keyed to user_id

ğŸ§¾ TOKEN DEDUCTION RULES
All AI calls deduct tokens based on combined input + output

Display running balance in UI (optional)

If balance = 0 â†’ Block use and show:

ğŸ”’ Youâ€™ve used all your credits. [Buy More Credits]

ğŸ“„ DOCUMENT UPLOADS + PRICING
ğŸ“¤ UPLOAD RULES
Only registered users may upload files (PDF, DOCX, TXT)

Attempted upload by unregistered user shows:

ğŸ”’ File upload requires registration. [Register & Unlock Access]

ğŸ’° ONE-TIME UPLOAD COST
1 token per 100 words (rounded up)

Minimum charge: 100 tokens

Maximum charge: 10,000 tokens

Deducted silently at time of upload

ğŸ—„ï¸ OPTIONAL STORAGE COST (IF RETAINED)
1 token per 250 words per month

Auto-deduct from token balance monthly

If insufficient balance â†’ lock access:

ğŸ”’ File storage paused until credits are added. [Buy More Credits]

ğŸ§  NEON DATABASE SETUP (SINGLE SHARED DB)
ğŸ“¦ DATABASE STRUCTURE
sql
Copy
Edit
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  token_balance INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  filename TEXT NOT NULL,
  content TEXT NOT NULL,
  word_count INTEGER,
  uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
ğŸ”’ SECURITY RULES
One Neon DB for all users

Every query scoped by user_id

No multi-tenant schema

No raw SELECT * without filtering

All backend routes extract user_id from session

Example Query:
ts
Copy
Edit
await db.select().from(documents).where(eq(documents.user_id, currentUserId));
ğŸ” SESSION-BASED TRACKING (NO IP-BASED LIMITS)
Session ID or user_id used for tracking

Never use IP address (due to proxy rotation)

Session and auth persist across page reloads

ğŸ§¾ TOKEN LOGGING
All token activity must log:

Timestamp

Session or user ID

Tokens used

Balance remaining

âœ… REQUIRED TEST CASES (DO NOT MARK COMPLETE UNTIL ALL PASS)
âŒ Unregistered user submits prompt â†’ receives only preview + upgrade message

âœ… Registered user uploads file â†’ correct tokens deducted

âœ… Registered user buys credits â†’ balance updated

âœ… Page refresh â†’ session and login persist

âœ… User A uploads doc â†’ User B cannot access

âœ… User A deletes doc â†’ Only their files are affected

